# Set the download URL and the target file name
$downloadUrl = "https://pestudio.en.lo4d.com/download/mirror-ex1"
$fileName = "pestudio.zip"
$extractDir = "pestudio"

# Download the file using Invoke-WebRequest
Write-Host "Downloading PeStudio..."
Invoke-WebRequest -Uri $downloadUrl -OutFile $fileName

# Check if the download was successful
if (!(Test-Path $fileName)) {
    Write-Host "Download failed!"
    exit 1
}

# Create a directory for extraction
Write-Host "Creating extraction directory..."
New-Item -ItemType Directory -Force -Path $extractDir

# Extract the ZIP file
Write-Host "Extracting the file..."
Add-Type -AssemblyName System.IO.Compression.FileSystem
[System.IO.Compression.ZipFile]::ExtractToDirectory($fileName, $extractDir)

# Check if the extraction was successful
if (!(Test-Path $extractDir)) {
    Write-Host "Extraction failed!"
    exit 1
}

# Navigate to the extracted directory
Write-Host "Running the application..."
$executable = Get-ChildItem -Path $extractDir -Filter *.exe -Recurse | Select-Object -First 1

if ($null -eq $executable) {
    Write-Host "Executable not found!"
    exit 1
}

# Run the executable
Start-Process -FilePath $executable.FullName

# Cleanup - optionally remove the downloaded ZIP file
Write-Host "Cleaning up..."
Remove-Item -Force $fileName

Write-Host "Done!"
